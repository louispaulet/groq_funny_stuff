import{j as n,a as h}from"./react-CBvpcIy-.js";import{C as L,O as v,u as C,B as F,F as g,V as f,S as M}from"./stl-CiNzZTSe.js";import"./markdown-VSOJ9Hrc.js";function E(r){const t=[],o=[];let e=0,s=0,c=1;const i=/[-+]?\d*\.?\d+(?:[eE][+-]?\d+)?/g,d=String(r).split(/\r?\n/);for(let m=0;m<d.length;m+=1){const l=d[m].trim();if(l){if(l.toLowerCase().startsWith("facet normal")){const a=l.match(i);a&&a.length>=3&&(e=parseFloat(a[0]),s=parseFloat(a[1]),c=parseFloat(a[2]))}else if(l.toLowerCase().startsWith("vertex")){const a=l.match(i);if(a&&a.length>=3){const y=parseFloat(a[0]),S=parseFloat(a[1]),b=parseFloat(a[2]);t.push(y,S,b),o.push(e,s,c)}}}}const w=t.length/3,p=Math.floor(w/3),x=p*9;if(t.length>x&&(t.length=x,o.length=p*9),t.length===0)return null;const u=new F;u.setAttribute("position",new g(t,3));try{u.setAttribute("normal",new g(o,3))}catch{}return u}function j(r){const t=r;t.computeVertexNormals(),t.computeBoundingBox();const o=t.boundingBox,e=new f;o.getSize(e);const c=1.8/(Math.max(e.x,e.y,e.z)||1),i=new f;return o.getCenter(i),t.translate(-i.x,-i.y,-i.z),{geometry:t,scale:c}}function z(r){try{if(/^https?:\/\//i.test(r))return`/stl-proxy?url=${encodeURIComponent(r)}`}catch{}return r}function B({url:r}){const t=z(r),o=C(M,t,s=>{s.setCrossOrigin("anonymous")}),{scale:e}=h.useMemo(()=>j(o),[o]);return n.jsx("group",{scale:[e,e,e],children:n.jsx("mesh",{geometry:o,castShadow:!0,receiveShadow:!0,children:n.jsx("meshStandardMaterial",{color:"#9ca3af",metalness:.1,roughness:.8})})})}function T({text:r}){const t=h.useMemo(()=>{try{const s=E(r);if(!s)throw new Error("No triangles parsed");return j(s)}catch(s){return console.error("STL parse failed",s),null}},[r]);if(!t)throw new Error("Invalid or incomplete STL content");const{geometry:o,scale:e}=t;return n.jsx("group",{scale:[e,e,e],children:n.jsx("mesh",{geometry:o,castShadow:!0,receiveShadow:!0,children:n.jsx("meshStandardMaterial",{color:"#9ca3af",metalness:.1,roughness:.8})})})}function R({source:r,className:t}){return n.jsx("div",{className:t,children:n.jsxs(L,{camera:{position:[2.8,2.2,2.8],fov:50},gl:{antialias:!0,powerPreference:"high-performance"},shadows:!1,onCreated:({gl:o})=>{const e=o.domElement,s=c=>{c.preventDefault()};e.addEventListener("webglcontextlost",s,!1)},children:[n.jsx("color",{attach:"background",args:[0,0,0]}),n.jsx(h.Suspense,{fallback:null,children:r?.type==="text"?n.jsx(T,{text:r.text}):n.jsx(B,{url:r?.url})}),n.jsx("ambientLight",{intensity:.6}),n.jsx("directionalLight",{position:[3,5,4],intensity:.8,castShadow:!0}),n.jsx("directionalLight",{position:[-3,-2,-4],intensity:.3}),n.jsx(v,{enableDamping:!0,dampingFactor:.1}),n.jsx("gridHelper",{args:[10,10,"#94a3b8","#e2e8f0"],position:[0,-1.2,0]})]})})}export{R as default};
