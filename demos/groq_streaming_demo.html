<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Groq One-Shot Playground</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, Inter, Segoe UI, Roboto, Arial; margin: 2rem; max-width: 60ch }
      input, button { font-size: 1rem; padding: 0.5rem; margin-top: 0.5rem }
      pre { white-space: pre-wrap; padding: 1rem; background: #f6f6f6; border-radius: 8px }
    </style>
  </head>
  <body>
    <h1>Groq Responses API (Frontend / Unsafe)</h1>
    <input id="msg" type="text" placeholder="Type your message..." size="50" />
    <br/>
    <button id="go">Send</button>
    <pre id="out"></pre>

    <script type="module">
      const baseEndpoint = (window.VITE_CHAT_BASE_URL || 'https://groq-endpoint.louispaulet13.workers.dev').replace(/\/$/, '');

      const msg = document.getElementById("msg");
      const out = document.getElementById("out");
      const go = document.getElementById("go");

      go.addEventListener("click", async () => {
        const text = msg.value.trim();
        if (!text) {
          out.textContent = "Please type a message first.";
          return;
        }
        out.textContent = "Calling /chat workerâ€¦";
        try {
          const response = await fetch(`${baseEndpoint}/chat`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: [
                { role: 'system', content: 'You are a helpful assistant.' },
                { role: 'user', content: text },
              ],
            }),
          });

          if (!response.ok) {
            const errorBody = await response.text();
            throw new Error(`HTTP ${response.status}: ${errorBody}`);
          }

          const payload = await response.json();
          const content = payload?.choices?.[0]?.message?.content?.trim() || '';
          out.textContent = content || '(no content returned)';
        } catch (err) {
          out.textContent = "Error: " + (err?.message || err);
        }
      });
    </script>
  </body>
</html>
